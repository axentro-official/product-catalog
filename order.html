<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</title>

  <style>
    :root{
      --bg1:#0b1020; --bg2:#0f172a;
      --stroke:#ffffff1a; --text:#e5e7eb; --muted:#94a3b8;
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
      --ok:#22c55e; --warn:#facc15; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(96,165,250,.25), transparent 55%),
        radial-gradient(700px 500px at 90% 20%, rgba(167,139,250,.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding:18px;
      min-height:100vh;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto}
    .top{
      display:flex;justify-content:space-between;align-items:center;gap:12px;
      padding:12px 14px;border:1px solid var(--stroke);
      border-radius:18px;background:rgba(255,255,255,.06);
      box-shadow:var(--shadow);backdrop-filter:blur(10px);
    }
    .back{
      padding:10px 12px;border-radius:14px;
      border:1px solid var(--stroke);background:rgba(255,255,255,.06)
    }
    .title{font-weight:900}

    .card{
      margin-top:14px;padding:14px;
      border:1px solid var(--stroke);border-radius:var(--radius);
      background:rgba(255,255,255,.06);box-shadow:var(--shadow);
    }

    .note{
      margin-top:12px;padding:12px;border-radius:16px;
      border:1px solid rgba(96,165,250,.25);
      background:rgba(96,165,250,.08);
      color:#dbeafe;font-weight:800;line-height:1.7;
    }

    .seg{
      display:flex;gap:14px;flex-wrap:wrap;
      padding:10px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      margin-top:10px;
    }

    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input{
      width:100%;padding:12px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);color:var(--text);
      outline:none;
    }
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:720px){.row2{grid-template-columns:1fr}}

    .items{
      display:flex; flex-direction:column; gap:10px;
      margin-top:10px;
    }
    .item{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius:16px;
      padding:10px;
      display:flex; gap:10px; align-items:center;
    }
    .thumb{
      width:56px;height:56px;border-radius:14px;
      border:1px solid var(--stroke);
      object-fit:cover;background:rgba(255,255,255,.04);
      flex:0 0 auto;
    }
    .iInfo{flex:1; min-width:0}
    .iName{font-weight:900; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .iMeta{font-size:11px;color:var(--muted); margin-top:3px}
    .status{font-weight:900}
    .st-available{color:var(--ok)}
    .st-low{color:var(--warn)}
    .st-out{color:var(--bad)}
    .st-unknown{color:#cbd5e1}

    .qtyBox{display:flex; align-items:center; gap:6px}
    .qBtn{
      width:32px;height:32px;border-radius:12px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;font-weight:900;
    }
    .qVal{
      width:42px;text-align:center;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      border-radius:12px;
      padding:7px 6px;
      font-weight:900;font-size:12px;
    }
    .rmBtn{
      margin-top:6px;
      font-size:11px;
      color:#fca5a5;
      cursor:pointer;
      user-select:none;
    }

    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{
      cursor:pointer;border-radius:16px;padding:12px 14px;
      font-weight:900;border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);color:var(--text);
      flex:1;
    }
    .primary{
      border-color:rgba(96,165,250,.45);
      background:linear-gradient(135deg, rgba(96,165,250,.30), rgba(167,139,250,.18));
    }
    .success{
      margin-top:12px;padding:12px;border-radius:16px;
      border:1px solid rgba(34,197,94,.25);
      background:rgba(34,197,94,.10);
      color:#dcfce7;font-weight:900;line-height:1.7;
      display:none;
    }
    .empty{
      padding:14px;
      border:1px dashed var(--stroke);
      border-radius: var(--radius);
      color:var(--muted);
      text-align:center;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <a class="back" href="./">â† Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙƒØªØ§Ù„ÙˆØ¬</a>
    <div class="title">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</div>
    <div></div>
  </div>

  <div class="card">
    <div style="font-weight:900">ğŸ›’ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø³Ù„Ø©</div>
    <div id="cartBox" class="items"></div>

    <div class="note" id="note"></div>

    <div style="margin-top:10px;font-weight:900">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</div>
    <div class="seg">
      <label><input type="radio" name="type" value="Ù‚Ø·Ø§Ø¹ÙŠ" checked> Ù‚Ø·Ø§Ø¹ÙŠ</label>
      <label><input type="radio" name="type" value="Ø¬Ù…Ù„Ø©"> Ø¬Ù…Ù„Ø©</label>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:900;margin-bottom:8px">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>

    <div class="row2">
      <div>
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input id="name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" />
      </div>
      <div>
        <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
        <input id="phone" placeholder="Ù…Ø«Ø§Ù„: 01xxxxxxxxx" />
      </div>
    </div>

    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <input id="address" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© / Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / ØªÙØ§ØµÙŠÙ„" />

    <div class="btns">
      <button class="primary" id="sendOrder">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨ + Ø¥ÙŠÙ…ÙŠÙ„)</button>
      <button id="clear">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
    </div>

    <div id="ok" class="success"></div>
  </div>
</div>

<script>
  /* ====== Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ====== */
  const OWNER_WA = "201146476993";
  const OWNER_EMAIL = "axentroofficial@gmail.com";

  /* ====== Ù†ÙØ³ API Ø¨ØªØ§Ø¹ Google Sheets ====== */
  const API_URL = "https://script.google.com/macros/s/AKfycbwsPPw3UiW6TBngBcbFxY4E8rB7JYgK1W2LRn0WaS9C7OitA1FgZ1vAz9Qr1u_ojlZ8/exec";

  const LS_KEY = "AX_CART_V1";
  const cartBox = document.getElementById("cartBox");
  const note = document.getElementById("note");
  const ok = document.getElementById("ok");

  // âœ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‡ØªØªØ­Ù…Ù„ Ù…Ù† Ø§Ù„Ø´ÙŠØª
  let products = [];

  function statusClass(av){
    if(av === "Low stock") return "st-low";
    if(av === "Out of stock") return "st-out";
    if(av === "Available") return "st-available";
    return "st-unknown";
  }

  function getType(){
    return document.querySelector("input[name='type']:checked").value;
  }

  function setNote(){
    note.textContent =
      getType()==="Ø¬Ù…Ù„Ø©"
      ? "âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø§Ù„Ø¬Ù…Ù„Ø©. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ."
      : "âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©.";
  }

  function getCart(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){ return []; }
  }
  function setCart(items){
    localStorage.setItem(LS_KEY, JSON.stringify(items));
  }

  function setQty(pid, qty){
    const cart = getCart();
    const idx = cart.findIndex(x=>x.id===pid);
    if(idx<0) return;
    cart[idx].qty = Math.max(1, Number(qty)||1);
    setCart(cart);
    renderCart();
  }

  function removeItem(pid){
    setCart(getCart().filter(x=>x.id!==pid));
    renderCart();
  }

  function findProduct(pid){
    return products.find(x=>x.id===pid) || null;
  }

  function renderCart(){
    const cart = getCart();
    cartBox.innerHTML = "";

    if(cart.length === 0){
      cartBox.innerHTML = `<div class="empty">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©. Ø§Ø±Ø¬Ø¹ Ù„Ù„ÙƒØªØ§Ù„ÙˆØ¬ ÙˆØ£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª.</div>`;
      return;
    }

    cart.forEach(it=>{
      const p = findProduct(it.id);

      // Ù„Ùˆ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø´ÙŠØª (Ø§ØªÙ…Ø³Ø­ Ø£Ùˆ Ø§ØªØºÙŠØ± ID)
      const safe = p || {
        id: it.id,
        name: "Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªØ§Ø­ (ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬)",
        category: "â€”",
        image: "https://via.placeholder.com/300x200?text=No+Image",
        availability: "Unknown"
      };

      const row = document.createElement("div");
      row.className = "item";

      row.innerHTML = `
        <img class="thumb" src="${safe.image || "https://via.placeholder.com/300x200?text=No+Image"}"
          onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">

        <div class="iInfo">
          <div class="iName">${safe.name}</div>
          <div class="iMeta">
            ${safe.category} â€¢
            <span class="status ${statusClass(safe.availability)}">${safe.availability}</span> â€¢
            ${safe.id}
          </div>
          <div class="rmBtn" data-rm="${safe.id}">Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ù„Ø©</div>
        </div>

        <div class="qtyBox">
          <button class="qBtn" data-minus="${safe.id}">âˆ’</button>
          <div class="qVal">${Number(it.qty)||1}</div>
          <button class="qBtn" data-plus="${safe.id}">+</button>
        </div>
      `;

      cartBox.appendChild(row);
    });

    cartBox.querySelectorAll("[data-plus]").forEach(b=>{
      b.onclick = ()=> {
        const id = b.getAttribute("data-plus");
        const cart = getCart();
        const it = cart.find(x=>x.id===id);
        setQty(id, (Number(it?.qty)||1) + 1);
      };
    });

    cartBox.querySelectorAll("[data-minus]").forEach(b=>{
      b.onclick = ()=> {
        const id = b.getAttribute("data-minus");
        const cart = getCart();
        const it = cart.find(x=>x.id===id);
        setQty(id, Math.max(1, (Number(it?.qty)||1) - 1));
      };
    });

    cartBox.querySelectorAll("[data-rm]").forEach(b=>{
      b.onclick = ()=> removeItem(b.getAttribute("data-rm"));
    });
  }

  function validate(){
    const cart = getCart();
    if(!cart.length) return "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.";
    const phone = (document.getElementById("phone").value||"").trim();
    if(!phone) return "Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„.";
    return "";
  }

  function buildMsg(){
    const cart = getCart();
    const t = getType();
    const name = (document.getElementById("name").value||"").trim();
    const phone = (document.getElementById("phone").value||"").trim();
    const address = (document.getElementById("address").value||"").trim();

    const lines = [];
    lines.push("ğŸ§¾ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯");
    lines.push("");
    lines.push(`Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨: ${t}`);
    lines.push("");
    lines.push("Ø§Ù„Ø£ØµÙ†Ø§Ù:");

    cart.forEach((it, i)=>{
      const p = findProduct(it.id);
      const pname = p ? p.name : "Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªØ§Ø­ (ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬)";
      const pstatus = p ? p.availability : "Unknown";
      lines.push(`${i+1}) ${pname} (${it.id}) â€” ÙƒÙ…ÙŠØ©: ${it.qty} â€” Ø­Ø§Ù„Ø©: ${pstatus}`);
    });

    lines.push("");
    lines.push("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:");
    lines.push(`Ø§Ù„Ø§Ø³Ù…: ${name || "â€”"}`);
    lines.push(`Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: ${phone || "â€”"}`);
    lines.push(`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address || "â€”"}`);

    return lines.join("\n");
  }

  async function loadProducts(){
    // Ø±Ø³Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ø¨Ø¯Ù„ Ù…Ø§ Ø§Ù„ØµÙØ­Ø© ØªØ¨Ù‚Ù‰ ÙØ§Ø¶ÙŠØ©
    cartBox.innerHTML = `<div class="empty">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>`;
    try{
      const res = await fetch(API_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);

      const data = await res.json();
      products = Array.isArray(data) ? data : [];

      // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù†Ø±Ø³Ù… Ø§Ù„Ø³Ù„Ø©
      renderCart();
    }catch(err){
      console.error(err);
      // Ø­ØªÙ‰ Ù„Ùˆ API ÙˆÙ‚Ø¹ØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø© Ù„ÙƒÙ† Ø¨Ø¯ÙˆÙ† Ø£Ø³Ù…Ø§Ø¡ Ù…Ø­Ø¯Ø«Ø©
      products = [];
      renderCart();
      note.textContent = "âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø´ÙŠØª Ø§Ù„Ø¢Ù†ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ³ÙŠØµÙ„ Ù…Ø¹ Ø§Ù„Ù€ IDs ÙˆØ§Ù„ÙƒÙ…ÙŠØ§Øª.";
    }
  }

  document.querySelectorAll("input[name='type']").forEach(r=> r.addEventListener("change", setNote));
  setNote();

  document.getElementById("clear").addEventListener("click", ()=>{
    setCart([]);
    renderCart();
    ok.style.display="none";
  });

  document.getElementById("sendOrder").addEventListener("click", ()=>{
    const err = validate();
    if(err) return alert(err);

    const msg = buildMsg();

    // 1) WhatsApp
    const waUrl = `https://wa.me/${OWNER_WA}?text=${encodeURIComponent(msg)}`;
    window.open(waUrl, "_blank");

    // 2) Email (mailto) Ø¨Ø¹Ø¯ 300ms
    const subject = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬";
    const mailUrl = `mailto:${encodeURIComponent(OWNER_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(msg)}`;
    setTimeout(() => { window.location.href = mailUrl; }, 300);

    ok.style.display="block";
    ok.textContent =
      (getType()==="Ø¬Ù…Ù„Ø©")
      ? "âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø§Ù„Ø¬Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ."
      : "âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©.";
  });

  // Init
  loadProducts();
</script>
</body>
</html>
